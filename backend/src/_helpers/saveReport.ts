import { ObjectId } from "mongoose";
import { Scan } from "../models/model";

export async function saveReport(
  userId: string,
  url: string,
  status: string,
  result: string
) {
  const scan = new Scan({
    userId,
    url,
    status,
    result,
  });

  try {
    await scan.save();
  } catch (error: any) {
    throw new Error(error);
  }
}

export async function getReports(_id: string) {
  try {
    return await Scan.find({ _id });
  } catch (error: any) {
    throw new Error(error);
  }
}

// update the status of the scan
export async function updateScanStatus(
  userId: string,
  url: string,
  status: string,
  nmap: boolean,
  zap: boolean
) {
  try {
    const data = await Scan.findOneAndUpdate(
      { userId, url, status: "pending" },
      { status, nmap, zap }
    );
    return data?._id;
  } catch (error: any) {
    throw new Error(error);
  }
}

// save the report by updaitng the status
export async function saveResult(scanId: string, result: string) {
  try {
    await Scan.findOneAndUpdate({ _id: scanId }, { result });
  } catch (error: any) {
    throw new Error(error);
  }
}

// get the report by scan id 
export async function getReport(scanId: string) {
  try {
    return await Scan.findOne({ _id: scanId });
  }
  catch (error: any) {
    throw new Error(error);
  } 
}